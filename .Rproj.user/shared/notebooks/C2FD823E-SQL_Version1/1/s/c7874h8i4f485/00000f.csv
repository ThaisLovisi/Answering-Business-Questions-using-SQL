"0","query_pred <- '"
"0","WITH country_or_other AS"
"0","    ("
"0","     SELECT"
"0","       CASE"
"0","           WHEN ("
"0","                 SELECT count(*)"
"0","                 FROM customer"
"0","                 where country = c.country"
"0","                ) = 1 THEN ""Other"""
"0","           ELSE c.country"
"0","       END AS country,"
"0","       c.customer_id,"
"0","       il.*"
"0","     FROM invoice_line il"
"0","     INNER JOIN invoice i ON i.invoice_id = il.invoice_id"
"0","     INNER JOIN customer c ON c.customer_id = i.customer_id"
"0","    )"
"0","SELECT"
"0","    country,"
"0","    customers,"
"0","    total_sales,"
"0","    average_order,"
"0","    customer_lifetime_value"
"0","FROM"
"0","    ("
"0","    SELECT"
"0","        country,"
"0","        count(distinct customer_id) customers,"
"0","        SUM(unit_price) total_sales,"
"0","        SUM(unit_price) / count(distinct customer_id) customer_lifetime_value,"
"0","        SUM(unit_price) / count(distinct invoice_id) average_order,"
"0","        CASE"
"0","            WHEN country = ""Other"" THEN 1"
"0","            ELSE 0"
"0","        END AS sort"
"0","    FROM country_or_other"
"0","    GROUP BY country"
"0","    ORDER BY sort ASC, total_sales DESC"
"0","    );"
"0","'"
"0","run_query(query_pred)"
